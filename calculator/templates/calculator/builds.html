{% extends "base.html" %}
{% block content %}
{% load currency_tags %}
<div class="container">
    {% if builds %}
        <div class="row">
            {% for build in builds %}
                <div class="col-md-6">
                    <div class="card mb-3 shadow-sm">
                        <div class="card-header bg-dark text-white">
                            {% if build.is_upgrade %}Upgrade #{{ forloop.counter }}{% else %}Build #{{ forloop.counter }}{% endif %}
                        </div>
                        <div class="card-body">
                            <p><strong>CPU:</strong> {{ build.cpu.name }}</p>
                            <p><strong>GPU:</strong> {{ build.gpu.gpu_name }}</p>
                            <p><strong>Motherboard:</strong> {{ build.motherboard.name }}</p>
                            <p><strong>RAM:</strong> {{ build.ram.name }}</p>
                            <p><strong>Storage:</strong> {{ build.storage.name }}</p>
                            <p><strong>PSU:</strong> {{ build.psu.name }}</p>
                            <p><strong>Cooler:</strong> {{ build.cooler.name }}</p>
                            <p><strong>Case:</strong> {{ build.case.name }}</p>
                            <hr>
                            {% load currency_tags %}
                            <p><strong>Budget:</strong>
                                {% if build.display_budget %}
                                    {{ build.currency|currency_symbol }}{{ build.display_budget|floatformat:2 }}
                                {% else %}
                                    &mdash;
                                {% endif %}
                            </p>
                            {% if build.is_upgrade %}
                                <p><strong>Cost:</strong> {{ build.currency|currency_symbol }}{{ build.display_price|convert_from_usd:build.currency|floatformat:2 }}</p>
                                <p><strong>Estimated gain:</strong>
                                    {% if build.estimated_gain %}
                                        {{ build.estimated_gain|floatformat:1 }}%
                                    {% else %}
                                        &mdash;
                                    {% endif %}
                                </p>
                            {% else %}
                                <p><strong>Cost:</strong> {{ build.currency|currency_symbol }}{{ build.total_price|convert_from_usd:build.currency|floatformat:2 }}</p>
                                <p><strong>Score:</strong> {{ build.total_score }}</p>
                            {% endif %}
                        </div>
                                                <div class="card-footer d-flex justify-content-between">
                                                        {% if build.is_upgrade %}
                                                            <a href="{% url 'view_saved_upgrade' build.pk %}" class="btn btn-outline-primary btn-sm">View</a>
                                                        {% else %}
                                                            <a href="{% url 'build_preview_pk' build.pk %}" class="btn btn-outline-primary btn-sm">View</a>
                                                        {% endif %}
                                                        <a href="{% url 'edit_build' build.pk %}" class="btn btn-outline-warning btn-sm">Edit</a>
                                                        <!-- Delete button triggers modal -->
                                                        <button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal{{ build.pk }}">Delete</button>
                                                </div>
                                        </div>

                                        <!-- Modal (placed after the card to avoid overlap) -->
                                        <div class="modal fade" id="deleteModal{{ build.pk }}" tabindex="-1" aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered">
                                                <div class="modal-content">
                                                    <div class="modal-header bg-danger text-white">
                                                        <h5 class="modal-title">Confirm Delete</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <p>Deleting this build is permanent. Are you sure you want to continue?</p>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <form method="post" action="{% url 'delete_build' build.pk %}">
                                                            {% csrf_token %}
                                                            <button type="submit" class="btn btn-outline-danger">Yes, Delete</button>
                                                        </form>
                                                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info">
            You donâ€™t have any saved builds yet. Go back to the <a href="{% url 'home' %}">calculator</a> to create one.
        </div>
    {% endif %}
</div>
{% endblock %}
