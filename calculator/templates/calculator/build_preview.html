{% extends "base.html" %}

{% load currency_tags %}
{% block content %}
<div class="container mt-4">
    <h2>Preview Build</h2>
    <div class="row">
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header">CPU</div>
                <div class="card-body">
                    <h5>{{ cpu.name }}</h5>
                    <p>Price: {{ currency|currency_symbol }}{{ cpu.price|convert_from_usd:currency|floatformat:2 }}</p>
                    <p>UserBenchmark: {{ cpu.userbenchmark_score }}</p>
                    <p>Blender: {{ cpu.blender_score }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header">Graphics Card</div>
                <div class="card-body">
                    <h5>{{ gpu.gpu_name }}</h5>
                    <p>Price: {{ currency|currency_symbol }}{{ gpu.price|convert_from_usd:currency|floatformat:2 }}</p>
                    <p>UserBenchmark: {{ gpu.userbenchmark_score }}</p>
                    <p>Blender: {{ gpu.blender_score }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header">Motherboard</div>
                <div class="card-body">
                    <h5>{{ motherboard.name }}</h5>
                    <p>Price: {{ currency|currency_symbol }}{{ motherboard.price|convert_from_usd:currency|floatformat:2 }}</p>
                    <p>Chipset: {{ motherboard.chipset }}</p>
                    <p>Blender: {{ motherboard.blender_score }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header">RAM</div>
                <div class="card-body">
                    <h5>{{ ram.name }}</h5>
                    <p>Price: {{ currency|currency_symbol }}{{ ram.price|convert_from_usd:currency|floatformat:2 }}</p>
                    <p>UserBenchmark: {{ ram.userbenchmark_score }}</p>
                    <p>Blender: {{ ram.blender_score }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header">Case</div>
                <div class="card-body">
                    <h5>{{ case.name }}</h5>
                    <p>Price: {{ currency|currency_symbol }}{{ case.price|convert_from_usd:currency|floatformat:2 }}</p>
                    <p>UserBenchmark: {{ case.userbenchmark_score }}</p>
                    <p>Blender: {{ case.blender_score }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header">Power Supply</div>
                <div class="card-body">
                    <h5>{{ psu.name }}</h5>
                    <p>Price: {{ currency|currency_symbol }}{{ psu.price|convert_from_usd:currency|floatformat:2 }}</p>
                    <p>UserBenchmark: {{ psu.userbenchmark_score }}</p>
                    <p>Blender: {{ psu.blender_score }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header">Storage</div>
                <div class="card-body">
                    <h5>{{ storage.name }}</h5>
                    <p>Price: {{ currency|currency_symbol }}{{ storage.price|convert_from_usd:currency|floatformat:2 }}</p>
                    <p>UserBenchmark: {{ storage.userbenchmark_score }}</p>
                    <p>Blender: {{ storage.blender_score }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header">CPU Cooler</div>
                <div class="card-body">
                    <h5>{{ cooler.name }}</h5>
                    <p>Price: {{ currency|currency_symbol }}{{ cooler.price|convert_from_usd:currency|floatformat:2 }}</p>
                    <p>UserBenchmark: {{ cooler.userbenchmark_score }}</p>
                    <p>Blender: {{ cooler.blender_score }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header">Case</div>
                <div class="card-body">
                    <h5>{{ case.name }}</h5>
                    <p>Price: {{ currency|currency_symbol }}{{ case.price|convert_from_usd:currency|floatformat:2 }}</p>
                    <p>UserBenchmark: {{ case.userbenchmark_score }}</p>
                    <p>Blender: {{ case.blender_score }}</p>
                </div>
            </div>
            
            
        </div>
        <!-- Repeat for GPU, RAM, Storage, PSU, Cooler, Case -->
    </div>

    <p><strong>Total Price:</strong> {{ currency|currency_symbol }}{{ price|convert_from_usd:currency|floatformat:2 }}</p>
    <p><strong>Total Score:</strong> {{ score }}</p>

{% if not is_saved_preview %}
    {% if user.is_authenticated %}
        <!-- Logged-in users: direct save -->
        <form method="post" action="{% url 'save_build' %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-success">Save build to account</button>
        </form>
    {% else %}
        <!-- Anonymous users: trigger signup modal -->
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#signupModal">
            Register to save this build
        </button>
    {% endif %}

    <form method="post" action="{% url 'clear_build' %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger mt-3">
                    Clear Current Build
            </button>
    </form>
{% endif %}

</div>
{% endblock %}
